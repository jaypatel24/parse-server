'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ParsePubSub = undefined;

var _AdapterLoader = require('../Adapters/AdapterLoader');

var _EventEmitterPubSub = require('../Adapters/PubSub/EventEmitterPubSub');

var _RedisPubSub = require('../Adapters/PubSub/RedisPubSub');

const ParsePubSub = {};

function useRedis(config) {
  const redisURL = config.redisURL;
  return typeof redisURL !== 'undefined' && redisURL !== '';
}

ParsePubSub.createPublisher = function (config) {
  if (useRedis(config)) {
    return _RedisPubSub.RedisPubSub.createPublisher(config);
  } else {
    const adapter = (0, _AdapterLoader.loadAdapter)(config.pubSubAdapter, _EventEmitterPubSub.EventEmitterPubSub, config);
    if (typeof adapter.createPublisher !== 'function') {
      throw 'pubSubAdapter should have createPublisher()';
    }
    return adapter.createPublisher(config);
  }
};

ParsePubSub.createSubscriber = function (config) {
  if (useRedis(config)) {
    return _RedisPubSub.RedisPubSub.createSubscriber(config);
  } else {
    const adapter = (0, _AdapterLoader.loadAdapter)(config.pubSubAdapter, _EventEmitterPubSub.EventEmitterPubSub, config);
    if (typeof adapter.createSubscriber !== 'function') {
      throw 'pubSubAdapter should have createSubscriber()';
    }
    return adapter.createSubscriber(config);
  }
};

exports.ParsePubSub = ParsePubSub;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXZlUXVlcnkvUGFyc2VQdWJTdWIuanMiXSwibmFtZXMiOlsiUGFyc2VQdWJTdWIiLCJ1c2VSZWRpcyIsImNvbmZpZyIsInJlZGlzVVJMIiwiY3JlYXRlUHVibGlzaGVyIiwiYWRhcHRlciIsInB1YlN1YkFkYXB0ZXIiLCJjcmVhdGVTdWJzY3JpYmVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBSUE7O0FBSUEsTUFBTUEsY0FBYyxFQUFwQjs7QUFFQSxTQUFTQyxRQUFULENBQWtCQyxNQUFsQixFQUF3QztBQUN0QyxRQUFNQyxXQUFXRCxPQUFPQyxRQUF4QjtBQUNBLFNBQU8sT0FBT0EsUUFBUCxLQUFvQixXQUFwQixJQUFtQ0EsYUFBYSxFQUF2RDtBQUNEOztBQUVESCxZQUFZSSxlQUFaLEdBQThCLFVBQVNGLE1BQVQsRUFBMkI7QUFDdkQsTUFBSUQsU0FBU0MsTUFBVCxDQUFKLEVBQXNCO0FBQ3BCLFdBQU8seUJBQVlFLGVBQVosQ0FBNEJGLE1BQTVCLENBQVA7QUFDRCxHQUZELE1BRU87QUFDTCxVQUFNRyxVQUFVLGdDQUFZSCxPQUFPSSxhQUFuQiwwQ0FBc0RKLE1BQXRELENBQWhCO0FBQ0EsUUFBSSxPQUFPRyxRQUFRRCxlQUFmLEtBQW1DLFVBQXZDLEVBQW1EO0FBQ2pELFlBQU0sNkNBQU47QUFDRDtBQUNELFdBQU9DLFFBQVFELGVBQVIsQ0FBd0JGLE1BQXhCLENBQVA7QUFDRDtBQUNGLENBVkQ7O0FBWUFGLFlBQVlPLGdCQUFaLEdBQStCLFVBQVNMLE1BQVQsRUFBNEI7QUFDekQsTUFBSUQsU0FBU0MsTUFBVCxDQUFKLEVBQXNCO0FBQ3BCLFdBQU8seUJBQVlLLGdCQUFaLENBQTZCTCxNQUE3QixDQUFQO0FBQ0QsR0FGRCxNQUVPO0FBQ0wsVUFBTUcsVUFBVSxnQ0FBWUgsT0FBT0ksYUFBbkIsMENBQXNESixNQUF0RCxDQUFoQjtBQUNBLFFBQUksT0FBT0csUUFBUUUsZ0JBQWYsS0FBb0MsVUFBeEMsRUFBb0Q7QUFDbEQsWUFBTSw4Q0FBTjtBQUNEO0FBQ0QsV0FBT0YsUUFBUUUsZ0JBQVIsQ0FBeUJMLE1BQXpCLENBQVA7QUFDRDtBQUNGLENBVkQ7O1FBYUVGLFcsR0FBQUEsVyIsImZpbGUiOiJQYXJzZVB1YlN1Yi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxvYWRBZGFwdGVyIH0gZnJvbSAnLi4vQWRhcHRlcnMvQWRhcHRlckxvYWRlcic7XG5pbXBvcnQge1xuICBFdmVudEVtaXR0ZXJQdWJTdWJcbn0gZnJvbSAnLi4vQWRhcHRlcnMvUHViU3ViL0V2ZW50RW1pdHRlclB1YlN1Yic7XG5cbmltcG9ydCB7XG4gIFJlZGlzUHViU3ViXG59IGZyb20gJy4uL0FkYXB0ZXJzL1B1YlN1Yi9SZWRpc1B1YlN1Yic7XG5cbmNvbnN0IFBhcnNlUHViU3ViID0ge307XG5cbmZ1bmN0aW9uIHVzZVJlZGlzKGNvbmZpZzogYW55KTogYm9vbGVhbiB7XG4gIGNvbnN0IHJlZGlzVVJMID0gY29uZmlnLnJlZGlzVVJMO1xuICByZXR1cm4gdHlwZW9mIHJlZGlzVVJMICE9PSAndW5kZWZpbmVkJyAmJiByZWRpc1VSTCAhPT0gJyc7XG59XG5cblBhcnNlUHViU3ViLmNyZWF0ZVB1Ymxpc2hlciA9IGZ1bmN0aW9uKGNvbmZpZzogYW55KTogYW55IHtcbiAgaWYgKHVzZVJlZGlzKGNvbmZpZykpIHtcbiAgICByZXR1cm4gUmVkaXNQdWJTdWIuY3JlYXRlUHVibGlzaGVyKGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYWRhcHRlciA9IGxvYWRBZGFwdGVyKGNvbmZpZy5wdWJTdWJBZGFwdGVyLCBFdmVudEVtaXR0ZXJQdWJTdWIsIGNvbmZpZylcbiAgICBpZiAodHlwZW9mIGFkYXB0ZXIuY3JlYXRlUHVibGlzaGVyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyAncHViU3ViQWRhcHRlciBzaG91bGQgaGF2ZSBjcmVhdGVQdWJsaXNoZXIoKSc7XG4gICAgfVxuICAgIHJldHVybiBhZGFwdGVyLmNyZWF0ZVB1Ymxpc2hlcihjb25maWcpO1xuICB9XG59XG5cblBhcnNlUHViU3ViLmNyZWF0ZVN1YnNjcmliZXIgPSBmdW5jdGlvbihjb25maWc6IGFueSk6IHZvaWQge1xuICBpZiAodXNlUmVkaXMoY29uZmlnKSkge1xuICAgIHJldHVybiBSZWRpc1B1YlN1Yi5jcmVhdGVTdWJzY3JpYmVyKGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYWRhcHRlciA9IGxvYWRBZGFwdGVyKGNvbmZpZy5wdWJTdWJBZGFwdGVyLCBFdmVudEVtaXR0ZXJQdWJTdWIsIGNvbmZpZylcbiAgICBpZiAodHlwZW9mIGFkYXB0ZXIuY3JlYXRlU3Vic2NyaWJlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgJ3B1YlN1YkFkYXB0ZXIgc2hvdWxkIGhhdmUgY3JlYXRlU3Vic2NyaWJlcigpJztcbiAgICB9XG4gICAgcmV0dXJuIGFkYXB0ZXIuY3JlYXRlU3Vic2NyaWJlcihjb25maWcpO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIFBhcnNlUHViU3ViXG59XG4iXX0=