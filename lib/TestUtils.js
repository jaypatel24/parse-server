'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.destroyAllDataPermanently = destroyAllDataPermanently;

var _cache = require('./cache');

var _cache2 = _interopRequireDefault(_cache);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Destroys all data in the database
 * @param {boolean} fast set to true if it's ok to just drop objects and not indexes.
 */
function destroyAllDataPermanently(fast) {
  if (!process.env.TESTING) {
    throw 'Only supported in test environment';
  }
  return Promise.all(Object.keys(_cache2.default.cache).map(appId => {
    const app = _cache2.default.get(appId);
    if (app.databaseController) {
      return app.databaseController.deleteEverything(fast);
    } else {
      return Promise.resolve();
    }
  }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9UZXN0VXRpbHMuanMiXSwibmFtZXMiOlsiZGVzdHJveUFsbERhdGFQZXJtYW5lbnRseSIsImZhc3QiLCJwcm9jZXNzIiwiZW52IiwiVEVTVElORyIsIlByb21pc2UiLCJhbGwiLCJPYmplY3QiLCJrZXlzIiwiY2FjaGUiLCJtYXAiLCJhcHBJZCIsImFwcCIsImdldCIsImRhdGFiYXNlQ29udHJvbGxlciIsImRlbGV0ZUV2ZXJ5dGhpbmciLCJyZXNvbHZlIl0sIm1hcHBpbmdzIjoiOzs7OztRQU1nQkEseUIsR0FBQUEseUI7O0FBTmhCOzs7Ozs7QUFFQTs7OztBQUlPLFNBQVNBLHlCQUFULENBQW1DQyxJQUFuQyxFQUF5QztBQUM5QyxNQUFJLENBQUNDLFFBQVFDLEdBQVIsQ0FBWUMsT0FBakIsRUFBMEI7QUFDeEIsVUFBTSxvQ0FBTjtBQUNEO0FBQ0QsU0FBT0MsUUFBUUMsR0FBUixDQUFZQyxPQUFPQyxJQUFQLENBQVksZ0JBQVNDLEtBQXJCLEVBQTRCQyxHQUE1QixDQUFnQ0MsU0FBUztBQUMxRCxVQUFNQyxNQUFNLGdCQUFTQyxHQUFULENBQWFGLEtBQWIsQ0FBWjtBQUNBLFFBQUlDLElBQUlFLGtCQUFSLEVBQTRCO0FBQzFCLGFBQU9GLElBQUlFLGtCQUFKLENBQXVCQyxnQkFBdkIsQ0FBd0NkLElBQXhDLENBQVA7QUFDRCxLQUZELE1BRU87QUFDTCxhQUFPSSxRQUFRVyxPQUFSLEVBQVA7QUFDRDtBQUNGLEdBUGtCLENBQVosQ0FBUDtBQVFEIiwiZmlsZSI6IlRlc3RVdGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBcHBDYWNoZSBmcm9tICcuL2NhY2hlJztcblxuLyoqXG4gKiBEZXN0cm95cyBhbGwgZGF0YSBpbiB0aGUgZGF0YWJhc2VcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmFzdCBzZXQgdG8gdHJ1ZSBpZiBpdCdzIG9rIHRvIGp1c3QgZHJvcCBvYmplY3RzIGFuZCBub3QgaW5kZXhlcy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlc3Ryb3lBbGxEYXRhUGVybWFuZW50bHkoZmFzdCkge1xuICBpZiAoIXByb2Nlc3MuZW52LlRFU1RJTkcpIHtcbiAgICB0aHJvdyAnT25seSBzdXBwb3J0ZWQgaW4gdGVzdCBlbnZpcm9ubWVudCc7XG4gIH1cbiAgcmV0dXJuIFByb21pc2UuYWxsKE9iamVjdC5rZXlzKEFwcENhY2hlLmNhY2hlKS5tYXAoYXBwSWQgPT4ge1xuICAgIGNvbnN0IGFwcCA9IEFwcENhY2hlLmdldChhcHBJZCk7XG4gICAgaWYgKGFwcC5kYXRhYmFzZUNvbnRyb2xsZXIpIHtcbiAgICAgIHJldHVybiBhcHAuZGF0YWJhc2VDb250cm9sbGVyLmRlbGV0ZUV2ZXJ5dGhpbmcoZmFzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gIH0pKTtcbn1cbiJdfQ==