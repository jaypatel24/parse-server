'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EventEmitterMQ = undefined;

var _events = require('events');

var _events2 = _interopRequireDefault(_events);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const emitter = new _events2.default.EventEmitter();
const subscriptions = new Map();

function unsubscribe(channel) {
  if (!subscriptions.has(channel)) {
    //console.log('No channel to unsub from');
    return;
  }
  //console.log('unsub ', channel);
  emitter.removeListener(channel, subscriptions.get(channel));
  subscriptions.delete(channel);
}

class Publisher {

  constructor(emitter) {
    this.emitter = emitter;
  }

  publish(channel, message) {
    this.emitter.emit(channel, message);
  }
}

class Consumer extends _events2.default.EventEmitter {

  constructor(emitter) {
    super();
    this.emitter = emitter;
  }

  subscribe(channel) {
    unsubscribe(channel);
    const handler = message => {
      this.emit('message', channel, message);
    };
    subscriptions.set(channel, handler);
    this.emitter.on(channel, handler);
  }

  unsubscribe(channel) {
    unsubscribe(channel);
  }
}

function createPublisher() {
  return new Publisher(emitter);
}

function createSubscriber() {
  return new Consumer(emitter);
}

const EventEmitterMQ = {
  createPublisher,
  createSubscriber
};

exports.EventEmitterMQ = EventEmitterMQ;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9NZXNzYWdlUXVldWUvRXZlbnRFbWl0dGVyTVEuanMiXSwibmFtZXMiOlsiZW1pdHRlciIsIkV2ZW50RW1pdHRlciIsInN1YnNjcmlwdGlvbnMiLCJNYXAiLCJ1bnN1YnNjcmliZSIsImNoYW5uZWwiLCJoYXMiLCJyZW1vdmVMaXN0ZW5lciIsImdldCIsImRlbGV0ZSIsIlB1Ymxpc2hlciIsImNvbnN0cnVjdG9yIiwicHVibGlzaCIsIm1lc3NhZ2UiLCJlbWl0IiwiQ29uc3VtZXIiLCJzdWJzY3JpYmUiLCJoYW5kbGVyIiwic2V0Iiwib24iLCJjcmVhdGVQdWJsaXNoZXIiLCJjcmVhdGVTdWJzY3JpYmVyIiwiRXZlbnRFbWl0dGVyTVEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7Ozs7O0FBRUEsTUFBTUEsVUFBVSxJQUFJLGlCQUFPQyxZQUFYLEVBQWhCO0FBQ0EsTUFBTUMsZ0JBQWdCLElBQUlDLEdBQUosRUFBdEI7O0FBRUEsU0FBU0MsV0FBVCxDQUFxQkMsT0FBckIsRUFBc0M7QUFDcEMsTUFBSSxDQUFDSCxjQUFjSSxHQUFkLENBQWtCRCxPQUFsQixDQUFMLEVBQWlDO0FBQy9CO0FBQ0E7QUFDRDtBQUNEO0FBQ0FMLFVBQVFPLGNBQVIsQ0FBdUJGLE9BQXZCLEVBQWdDSCxjQUFjTSxHQUFkLENBQWtCSCxPQUFsQixDQUFoQztBQUNBSCxnQkFBY08sTUFBZCxDQUFxQkosT0FBckI7QUFDRDs7QUFFRCxNQUFNSyxTQUFOLENBQWdCOztBQUdkQyxjQUFZWCxPQUFaLEVBQTBCO0FBQ3hCLFNBQUtBLE9BQUwsR0FBZUEsT0FBZjtBQUNEOztBQUVEWSxVQUFRUCxPQUFSLEVBQXlCUSxPQUF6QixFQUFnRDtBQUM5QyxTQUFLYixPQUFMLENBQWFjLElBQWIsQ0FBa0JULE9BQWxCLEVBQTJCUSxPQUEzQjtBQUNEO0FBVGE7O0FBWWhCLE1BQU1FLFFBQU4sU0FBdUIsaUJBQU9kLFlBQTlCLENBQTJDOztBQUd6Q1UsY0FBWVgsT0FBWixFQUEwQjtBQUN4QjtBQUNBLFNBQUtBLE9BQUwsR0FBZUEsT0FBZjtBQUNEOztBQUVEZ0IsWUFBVVgsT0FBVixFQUFpQztBQUMvQkQsZ0JBQVlDLE9BQVo7QUFDQSxVQUFNWSxVQUFXSixPQUFELElBQWE7QUFDM0IsV0FBS0MsSUFBTCxDQUFVLFNBQVYsRUFBcUJULE9BQXJCLEVBQThCUSxPQUE5QjtBQUNELEtBRkQ7QUFHQVgsa0JBQWNnQixHQUFkLENBQWtCYixPQUFsQixFQUEyQlksT0FBM0I7QUFDQSxTQUFLakIsT0FBTCxDQUFhbUIsRUFBYixDQUFnQmQsT0FBaEIsRUFBeUJZLE9BQXpCO0FBQ0Q7O0FBRURiLGNBQVlDLE9BQVosRUFBbUM7QUFDakNELGdCQUFZQyxPQUFaO0FBQ0Q7QUFuQndDOztBQXNCM0MsU0FBU2UsZUFBVCxHQUFnQztBQUM5QixTQUFPLElBQUlWLFNBQUosQ0FBY1YsT0FBZCxDQUFQO0FBQ0Q7O0FBRUQsU0FBU3FCLGdCQUFULEdBQWlDO0FBQy9CLFNBQU8sSUFBSU4sUUFBSixDQUFhZixPQUFiLENBQVA7QUFDRDs7QUFFRCxNQUFNc0IsaUJBQWlCO0FBQ3JCRixpQkFEcUI7QUFFckJDO0FBRnFCLENBQXZCOztRQU1FQyxjLEdBQUFBLGMiLCJmaWxlIjoiRXZlbnRFbWl0dGVyTVEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXZlbnRzIGZyb20gJ2V2ZW50cyc7XG5cbmNvbnN0IGVtaXR0ZXIgPSBuZXcgZXZlbnRzLkV2ZW50RW1pdHRlcigpO1xuY29uc3Qgc3Vic2NyaXB0aW9ucyA9IG5ldyBNYXAoKTtcblxuZnVuY3Rpb24gdW5zdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nKSB7XG4gIGlmICghc3Vic2NyaXB0aW9ucy5oYXMoY2hhbm5lbCkpIHtcbiAgICAvL2NvbnNvbGUubG9nKCdObyBjaGFubmVsIHRvIHVuc3ViIGZyb20nKTtcbiAgICByZXR1cm47XG4gIH1cbiAgLy9jb25zb2xlLmxvZygndW5zdWIgJywgY2hhbm5lbCk7XG4gIGVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoY2hhbm5lbCwgc3Vic2NyaXB0aW9ucy5nZXQoY2hhbm5lbCkpO1xuICBzdWJzY3JpcHRpb25zLmRlbGV0ZShjaGFubmVsKTtcbn1cblxuY2xhc3MgUHVibGlzaGVyIHtcbiAgZW1pdHRlcjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGVtaXR0ZXI6IGFueSkge1xuICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG4gIH1cblxuICBwdWJsaXNoKGNoYW5uZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoY2hhbm5lbCwgbWVzc2FnZSk7XG4gIH1cbn1cblxuY2xhc3MgQ29uc3VtZXIgZXh0ZW5kcyBldmVudHMuRXZlbnRFbWl0dGVyIHtcbiAgZW1pdHRlcjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGVtaXR0ZXI6IGFueSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5lbWl0dGVyID0gZW1pdHRlcjtcbiAgfVxuXG4gIHN1YnNjcmliZShjaGFubmVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB1bnN1YnNjcmliZShjaGFubmVsKTtcbiAgICBjb25zdCBoYW5kbGVyID0gKG1lc3NhZ2UpID0+IHtcbiAgICAgIHRoaXMuZW1pdCgnbWVzc2FnZScsIGNoYW5uZWwsIG1lc3NhZ2UpO1xuICAgIH1cbiAgICBzdWJzY3JpcHRpb25zLnNldChjaGFubmVsLCBoYW5kbGVyKTtcbiAgICB0aGlzLmVtaXR0ZXIub24oY2hhbm5lbCwgaGFuZGxlcik7XG4gIH1cblxuICB1bnN1YnNjcmliZShjaGFubmVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB1bnN1YnNjcmliZShjaGFubmVsKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVQdWJsaXNoZXIoKTogYW55IHtcbiAgcmV0dXJuIG5ldyBQdWJsaXNoZXIoZW1pdHRlcik7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZXIoKTogYW55IHtcbiAgcmV0dXJuIG5ldyBDb25zdW1lcihlbWl0dGVyKTtcbn1cblxuY29uc3QgRXZlbnRFbWl0dGVyTVEgPSB7XG4gIGNyZWF0ZVB1Ymxpc2hlcixcbiAgY3JlYXRlU3Vic2NyaWJlclxufVxuXG5leHBvcnQge1xuICBFdmVudEVtaXR0ZXJNUVxufVxuIl19