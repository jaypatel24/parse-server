'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getControllers = getControllers;
exports.getLoggerController = getLoggerController;
exports.getFilesController = getFilesController;
exports.getUserController = getUserController;
exports.getCacheController = getCacheController;
exports.getAnalyticsController = getAnalyticsController;
exports.getLiveQueryController = getLiveQueryController;
exports.getDatabaseController = getDatabaseController;
exports.getHooksController = getHooksController;
exports.getPushController = getPushController;
exports.getAuthDataManager = getAuthDataManager;
exports.getDatabaseAdapter = getDatabaseAdapter;

var _Auth = require('../Adapters/Auth');

var _Auth2 = _interopRequireDefault(_Auth);

var _Options = require('../Options');

var _AdapterLoader = require('../Adapters/AdapterLoader');

var _defaults = require('../defaults');

var _defaults2 = _interopRequireDefault(_defaults);

var _url = require('url');

var _url2 = _interopRequireDefault(_url);

var _LoggerController = require('./LoggerController');

var _FilesController = require('./FilesController');

var _HooksController = require('./HooksController');

var _UserController = require('./UserController');

var _CacheController = require('./CacheController');

var _LiveQueryController = require('./LiveQueryController');

var _AnalyticsController = require('./AnalyticsController');

var _PushController = require('./PushController');

var _PushQueue = require('../Push/PushQueue');

var _PushWorker = require('../Push/PushWorker');

var _DatabaseController = require('./DatabaseController');

var _DatabaseController2 = _interopRequireDefault(_DatabaseController);

var _SchemaCache = require('./SchemaCache');

var _SchemaCache2 = _interopRequireDefault(_SchemaCache);

var _GridStoreAdapter = require('../Adapters/Files/GridStoreAdapter');

var _WinstonLoggerAdapter = require('../Adapters/Logger/WinstonLoggerAdapter');

var _InMemoryCacheAdapter = require('../Adapters/Cache/InMemoryCacheAdapter');

var _AnalyticsAdapter = require('../Adapters/Analytics/AnalyticsAdapter');

var _MongoStorageAdapter = require('../Adapters/Storage/Mongo/MongoStorageAdapter');

var _MongoStorageAdapter2 = _interopRequireDefault(_MongoStorageAdapter);

var _PostgresStorageAdapter = require('../Adapters/Storage/Postgres/PostgresStorageAdapter');

var _PostgresStorageAdapter2 = _interopRequireDefault(_PostgresStorageAdapter);

var _pushAdapter = require('@parse/push-adapter');

var _pushAdapter2 = _interopRequireDefault(_pushAdapter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getControllers(options) {
  const loggerController = getLoggerController(options);
  const filesController = getFilesController(options);
  const userController = getUserController(options);
  const {
    pushController,
    hasPushScheduledSupport,
    hasPushSupport,
    pushControllerQueue,
    pushWorker
  } = getPushController(options);
  const cacheController = getCacheController(options);
  const analyticsController = getAnalyticsController(options);
  const liveQueryController = getLiveQueryController(options);
  const databaseController = getDatabaseController(options, cacheController);
  const hooksController = getHooksController(options, databaseController);
  const authDataManager = getAuthDataManager(options);
  return {
    loggerController,
    filesController,
    userController,
    pushController,
    hasPushScheduledSupport,
    hasPushSupport,
    pushWorker,
    pushControllerQueue,
    analyticsController,
    cacheController,
    liveQueryController,
    databaseController,
    hooksController,
    authDataManager
  };
}

// Adapters

// Controllers
function getLoggerController(options) {
  const {
    appId,
    jsonLogs,
    logsFolder,
    verbose,
    logLevel,
    silent,
    loggerAdapter
  } = options;
  const loggerOptions = { jsonLogs, logsFolder, verbose, logLevel, silent };
  const loggerControllerAdapter = (0, _AdapterLoader.loadAdapter)(loggerAdapter, _WinstonLoggerAdapter.WinstonLoggerAdapter, loggerOptions);
  return new _LoggerController.LoggerController(loggerControllerAdapter, appId, loggerOptions);
}

function getFilesController(options) {
  const {
    appId,
    databaseURI,
    filesAdapter,
    databaseAdapter,
    preserveFileName
  } = options;
  if (!filesAdapter && databaseAdapter) {
    throw 'When using an explicit database adapter, you must also use an explicit filesAdapter.';
  }
  const filesControllerAdapter = (0, _AdapterLoader.loadAdapter)(filesAdapter, () => {
    return new _GridStoreAdapter.GridStoreAdapter(databaseURI);
  });
  return new _FilesController.FilesController(filesControllerAdapter, appId, { preserveFileName });
}

function getUserController(options) {
  const {
    appId,
    emailAdapter,
    verifyUserEmails
  } = options;
  const emailControllerAdapter = (0, _AdapterLoader.loadAdapter)(emailAdapter);
  return new _UserController.UserController(emailControllerAdapter, appId, { verifyUserEmails });
}

function getCacheController(options) {
  const {
    appId,
    cacheAdapter,
    cacheTTL,
    cacheMaxSize
  } = options;
  const cacheControllerAdapter = (0, _AdapterLoader.loadAdapter)(cacheAdapter, _InMemoryCacheAdapter.InMemoryCacheAdapter, { appId: appId, ttl: cacheTTL, maxSize: cacheMaxSize });
  return new _CacheController.CacheController(cacheControllerAdapter, appId);
}

function getAnalyticsController(options) {
  const {
    analyticsAdapter
  } = options;
  const analyticsControllerAdapter = (0, _AdapterLoader.loadAdapter)(analyticsAdapter, _AnalyticsAdapter.AnalyticsAdapter);
  return new _AnalyticsController.AnalyticsController(analyticsControllerAdapter);
}

function getLiveQueryController(options) {
  return new _LiveQueryController.LiveQueryController(options.liveQuery);
}

function getDatabaseController(options, cacheController) {
  const {
    databaseURI,
    databaseOptions,
    collectionPrefix,
    schemaCacheTTL,
    enableSingleSchemaCache
  } = options;
  let {
    databaseAdapter
  } = options;
  if ((databaseOptions || databaseURI && databaseURI !== _defaults2.default.databaseURI || collectionPrefix !== _defaults2.default.collectionPrefix) && databaseAdapter) {
    throw 'You cannot specify both a databaseAdapter and a databaseURI/databaseOptions/collectionPrefix.';
  } else if (!databaseAdapter) {
    databaseAdapter = getDatabaseAdapter(databaseURI, collectionPrefix, databaseOptions);
  } else {
    databaseAdapter = (0, _AdapterLoader.loadAdapter)(databaseAdapter);
  }
  return new _DatabaseController2.default(databaseAdapter, new _SchemaCache2.default(cacheController, schemaCacheTTL, enableSingleSchemaCache));
}

function getHooksController(options, databaseController) {
  const {
    appId,
    webhookKey
  } = options;
  return new _HooksController.HooksController(appId, databaseController, webhookKey);
}

function getPushController(options) {
  const {
    scheduledPush,
    push
  } = options;

  const pushOptions = Object.assign({}, push);
  const pushQueueOptions = pushOptions.queueOptions || {};
  if (pushOptions.queueOptions) {
    delete pushOptions.queueOptions;
  }

  // Pass the push options too as it works with the default
  const pushAdapter = (0, _AdapterLoader.loadAdapter)(pushOptions && pushOptions.adapter, _pushAdapter2.default, pushOptions);
  // We pass the options and the base class for the adatper,
  // Note that passing an instance would work too
  const pushController = new _PushController.PushController();
  const hasPushSupport = !!(pushAdapter && push);
  const hasPushScheduledSupport = hasPushSupport && scheduledPush === true;

  const {
    disablePushWorker
  } = pushQueueOptions;

  const pushControllerQueue = new _PushQueue.PushQueue(pushQueueOptions);
  let pushWorker;
  if (!disablePushWorker) {
    pushWorker = new _PushWorker.PushWorker(pushAdapter, pushQueueOptions);
  }
  return {
    pushController,
    hasPushSupport,
    hasPushScheduledSupport,
    pushControllerQueue,
    pushWorker
  };
}

function getAuthDataManager(options) {
  const {
    auth,
    enableAnonymousUsers
  } = options;
  return (0, _Auth2.default)(auth, enableAnonymousUsers);
}

function getDatabaseAdapter(databaseURI, collectionPrefix, databaseOptions) {
  let protocol;
  try {
    const parsedURI = _url2.default.parse(databaseURI);
    protocol = parsedURI.protocol ? parsedURI.protocol.toLowerCase() : null;
  } catch (e) {/* */}
  switch (protocol) {
    case 'postgres:':
      return new _PostgresStorageAdapter2.default({
        uri: databaseURI,
        collectionPrefix,
        databaseOptions
      });
    default:
      return new _MongoStorageAdapter2.default({
        uri: databaseURI,
        collectionPrefix,
        mongoOptions: databaseOptions
      });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9pbmRleC5qcyJdLCJuYW1lcyI6WyJnZXRDb250cm9sbGVycyIsImdldExvZ2dlckNvbnRyb2xsZXIiLCJnZXRGaWxlc0NvbnRyb2xsZXIiLCJnZXRVc2VyQ29udHJvbGxlciIsImdldENhY2hlQ29udHJvbGxlciIsImdldEFuYWx5dGljc0NvbnRyb2xsZXIiLCJnZXRMaXZlUXVlcnlDb250cm9sbGVyIiwiZ2V0RGF0YWJhc2VDb250cm9sbGVyIiwiZ2V0SG9va3NDb250cm9sbGVyIiwiZ2V0UHVzaENvbnRyb2xsZXIiLCJnZXRBdXRoRGF0YU1hbmFnZXIiLCJnZXREYXRhYmFzZUFkYXB0ZXIiLCJvcHRpb25zIiwibG9nZ2VyQ29udHJvbGxlciIsImZpbGVzQ29udHJvbGxlciIsInVzZXJDb250cm9sbGVyIiwicHVzaENvbnRyb2xsZXIiLCJoYXNQdXNoU2NoZWR1bGVkU3VwcG9ydCIsImhhc1B1c2hTdXBwb3J0IiwicHVzaENvbnRyb2xsZXJRdWV1ZSIsInB1c2hXb3JrZXIiLCJjYWNoZUNvbnRyb2xsZXIiLCJhbmFseXRpY3NDb250cm9sbGVyIiwibGl2ZVF1ZXJ5Q29udHJvbGxlciIsImRhdGFiYXNlQ29udHJvbGxlciIsImhvb2tzQ29udHJvbGxlciIsImF1dGhEYXRhTWFuYWdlciIsImFwcElkIiwianNvbkxvZ3MiLCJsb2dzRm9sZGVyIiwidmVyYm9zZSIsImxvZ0xldmVsIiwic2lsZW50IiwibG9nZ2VyQWRhcHRlciIsImxvZ2dlck9wdGlvbnMiLCJsb2dnZXJDb250cm9sbGVyQWRhcHRlciIsImRhdGFiYXNlVVJJIiwiZmlsZXNBZGFwdGVyIiwiZGF0YWJhc2VBZGFwdGVyIiwicHJlc2VydmVGaWxlTmFtZSIsImZpbGVzQ29udHJvbGxlckFkYXB0ZXIiLCJlbWFpbEFkYXB0ZXIiLCJ2ZXJpZnlVc2VyRW1haWxzIiwiZW1haWxDb250cm9sbGVyQWRhcHRlciIsImNhY2hlQWRhcHRlciIsImNhY2hlVFRMIiwiY2FjaGVNYXhTaXplIiwiY2FjaGVDb250cm9sbGVyQWRhcHRlciIsInR0bCIsIm1heFNpemUiLCJhbmFseXRpY3NBZGFwdGVyIiwiYW5hbHl0aWNzQ29udHJvbGxlckFkYXB0ZXIiLCJsaXZlUXVlcnkiLCJkYXRhYmFzZU9wdGlvbnMiLCJjb2xsZWN0aW9uUHJlZml4Iiwic2NoZW1hQ2FjaGVUVEwiLCJlbmFibGVTaW5nbGVTY2hlbWFDYWNoZSIsIndlYmhvb2tLZXkiLCJzY2hlZHVsZWRQdXNoIiwicHVzaCIsInB1c2hPcHRpb25zIiwiT2JqZWN0IiwiYXNzaWduIiwicHVzaFF1ZXVlT3B0aW9ucyIsInF1ZXVlT3B0aW9ucyIsInB1c2hBZGFwdGVyIiwiYWRhcHRlciIsImRpc2FibGVQdXNoV29ya2VyIiwiYXV0aCIsImVuYWJsZUFub255bW91c1VzZXJzIiwicHJvdG9jb2wiLCJwYXJzZWRVUkkiLCJwYXJzZSIsInRvTG93ZXJDYXNlIiwiZSIsInVyaSIsIm1vbmdvT3B0aW9ucyJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUE0QmdCQSxjLEdBQUFBLGM7UUFtQ0FDLG1CLEdBQUFBLG1CO1FBZUFDLGtCLEdBQUFBLGtCO1FBaUJBQyxpQixHQUFBQSxpQjtRQVVBQyxrQixHQUFBQSxrQjtRQVdBQyxzQixHQUFBQSxzQjtRQVFBQyxzQixHQUFBQSxzQjtRQUlBQyxxQixHQUFBQSxxQjtRQXFCQUMsa0IsR0FBQUEsa0I7UUFlQUMsaUIsR0FBQUEsaUI7UUFzQ0FDLGtCLEdBQUFBLGtCO1FBUUFDLGtCLEdBQUFBLGtCOztBQWxOaEI7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUNBOzs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRU8sU0FBU1gsY0FBVCxDQUF3QlksT0FBeEIsRUFBcUQ7QUFDMUQsUUFBTUMsbUJBQW1CWixv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RTtBQUNqRixNQUFJaUIsUUFBSjtBQUNBLE1BQUk7QUFDRixVQUFNQyxZQUFZLGNBQUlDLEtBQUosQ0FBVXBDLFdBQVYsQ0FBbEI7QUFDQWtDLGVBQVdDLFVBQVVELFFBQVYsR0FBcUJDLFVBQVVELFFBQVYsQ0FBbUJHLFdBQW5CLEVBQXJCLEdBQXdELElBQW5FO0FBQ0QsR0FIRCxDQUdFLE9BQU1DLENBQU4sRUFBUyxDQUFFLEtBQU87QUFDcEIsVUFBUUosUUFBUjtBQUNBLFNBQUssV0FBTDtBQUNFLGFBQU8scUNBQTJCO0FBQ2hDSyxhQUFLdkMsV0FEMkI7QUFFaENrQix3QkFGZ0M7QUFHaENEO0FBSGdDLE9BQTNCLENBQVA7QUFLRjtBQUNFLGFBQU8sa0NBQXdCO0FBQzdCc0IsYUFBS3ZDLFdBRHdCO0FBRTdCa0Isd0JBRjZCO0FBRzdCc0Isc0JBQWN2QjtBQUhlLE9BQXhCLENBQVA7QUFSRjtBQWNEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF1dGhEYXRhTWFuYWdlciAgICAgICAgICBmcm9tICcuLi9BZGFwdGVycy9BdXRoJztcbmltcG9ydCB7IFBhcnNlU2VydmVyT3B0aW9ucyB9ICAgZnJvbSAnLi4vT3B0aW9ucyc7XG5pbXBvcnQgeyBsb2FkQWRhcHRlciB9ICAgICAgICAgIGZyb20gJy4uL0FkYXB0ZXJzL0FkYXB0ZXJMb2FkZXInO1xuaW1wb3J0IGRlZmF1bHRzICAgICAgICAgICAgICAgICBmcm9tICcuLi9kZWZhdWx0cyc7XG5pbXBvcnQgdXJsICAgICAgICAgICAgICAgICAgICAgIGZyb20gJ3VybCc7XG4vLyBDb250cm9sbGVyc1xuaW1wb3J0IHsgTG9nZ2VyQ29udHJvbGxlciB9ICAgICBmcm9tICcuL0xvZ2dlckNvbnRyb2xsZXInO1xuaW1wb3J0IHsgRmlsZXNDb250cm9sbGVyIH0gICAgICBmcm9tICcuL0ZpbGVzQ29udHJvbGxlcic7XG5pbXBvcnQgeyBIb29rc0NvbnRyb2xsZXIgfSAgICAgIGZyb20gJy4vSG9va3NDb250cm9sbGVyJztcbmltcG9ydCB7IFVzZXJDb250cm9sbGVyIH0gICAgICAgZnJvbSAnLi9Vc2VyQ29udHJvbGxlcic7XG5pbXBvcnQgeyBDYWNoZUNvbnRyb2xsZXIgfSAgICAgIGZyb20gJy4vQ2FjaGVDb250cm9sbGVyJztcbmltcG9ydCB7IExpdmVRdWVyeUNvbnRyb2xsZXIgfSAgZnJvbSAnLi9MaXZlUXVlcnlDb250cm9sbGVyJztcbmltcG9ydCB7IEFuYWx5dGljc0NvbnRyb2xsZXIgfSAgZnJvbSAnLi9BbmFseXRpY3NDb250cm9sbGVyJztcbmltcG9ydCB7IFB1c2hDb250cm9sbGVyIH0gICAgICAgZnJvbSAnLi9QdXNoQ29udHJvbGxlcic7XG5pbXBvcnQgeyBQdXNoUXVldWUgfSAgICAgICAgICAgIGZyb20gJy4uL1B1c2gvUHVzaFF1ZXVlJztcbmltcG9ydCB7IFB1c2hXb3JrZXIgfSAgICAgICAgICAgZnJvbSAnLi4vUHVzaC9QdXNoV29ya2VyJztcbmltcG9ydCBEYXRhYmFzZUNvbnRyb2xsZXIgICAgICAgZnJvbSAnLi9EYXRhYmFzZUNvbnRyb2xsZXInO1xuaW1wb3J0IFNjaGVtYUNhY2hlICAgICAgICAgICAgICBmcm9tICcuL1NjaGVtYUNhY2hlJztcblxuLy8gQWRhcHRlcnNcbmltcG9ydCB7IEdyaWRTdG9yZUFkYXB0ZXIgfSAgICAgZnJvbSAnLi4vQWRhcHRlcnMvRmlsZXMvR3JpZFN0b3JlQWRhcHRlcic7XG5pbXBvcnQgeyBXaW5zdG9uTG9nZ2VyQWRhcHRlciB9IGZyb20gJy4uL0FkYXB0ZXJzL0xvZ2dlci9XaW5zdG9uTG9nZ2VyQWRhcHRlcic7XG5pbXBvcnQgeyBJbk1lbW9yeUNhY2hlQWRhcHRlciB9IGZyb20gJy4uL0FkYXB0ZXJzL0NhY2hlL0luTWVtb3J5Q2FjaGVBZGFwdGVyJztcbmltcG9ydCB7IEFuYWx5dGljc0FkYXB0ZXIgfSAgICAgZnJvbSAnLi4vQWRhcHRlcnMvQW5hbHl0aWNzL0FuYWx5dGljc0FkYXB0ZXInO1xuaW1wb3J0IE1vbmdvU3RvcmFnZUFkYXB0ZXIgICAgICBmcm9tICcuLi9BZGFwdGVycy9TdG9yYWdlL01vbmdvL01vbmdvU3RvcmFnZUFkYXB0ZXInO1xuaW1wb3J0IFBvc3RncmVzU3RvcmFnZUFkYXB0ZXIgICBmcm9tICcuLi9BZGFwdGVycy9TdG9yYWdlL1Bvc3RncmVzL1Bvc3RncmVzU3RvcmFnZUFkYXB0ZXInO1xuaW1wb3J0IFBhcnNlUHVzaEFkYXB0ZXIgICAgICAgICBmcm9tICdAcGFyc2UvcHVzaC1hZGFwdGVyJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbnRyb2xsZXJzKG9wdGlvbnM6IFBhcnNlU2VydmVyT3B0aW9ucykge1xuICBjb25zdCBsb2dnZXJDb250cm9sbGVyID0gZ2V0TG9nZ2VyQ29udHJvbGxlcihvcHRpb25zKTtcbiAgY29uc3QgZmlsZXNDb250cm9sbGVyID0gZ2V0RmlsZXNDb250cm9sbGVyKG9wdGlvbnMpO1xuICBjb25zdCB1c2VyQ29udHJvbGxlciA9IGdldFVzZXJDb250cm9sbGVyKG9wdGlvbnMpO1xuICBjb25zdCB7XG4gICAgcHVzaENvbnRyb2xsZXIsXG4gICAgaGFzUHVzaFNjaGVkdWxlZFN1cHBvcnQsXG4gICAgaGFzUHVzaFN1cHBvcnQsXG4gICAgcHVzaENvbnRyb2xsZXJRdWV1ZSxcbiAgICBwdXNoV29ya2VyXG4gIH0gPSBnZXRQdXNoQ29udHJvbGxlcihvcHRpb25zKTtcbiAgY29uc3QgY2FjaGVDb250cm9sbGVyID0gZ2V0Q2FjaGVDb250cm9sbGVyKG9wdGlvbnMpO1xuICBjb25zdCBhbmFseXRpY3NDb250cm9sbGVyID0gZ2V0QW5hbHl0aWNzQ29udHJvbGxlcihvcHRpb25zKTtcbiAgY29uc3QgbGl2ZVF1ZXJ5Q29udHJvbGxlciA9IGdldExpdmVRdWVyeUNvbnRyb2xsZXIob3B0aW9ucyk7XG4gIGNvbnN0IGRhdGFiYXNlQ29udHJvbGxlciA9IGdldERhdGFiYXNlQ29udHJvbGxlcihvcHRpb25zLCBjYWNoZUNvbnRyb2xsZXIpO1xuICBjb25zdCBob29rc0NvbnRyb2xsZXIgPSBnZXRIb29rc0NvbnRyb2xsZXIob3B0aW9ucywgZGF0YWJhc2VDb250cm9sbGVyKTtcbiAgY29uc3QgYXV0aERhdGFNYW5hZ2VyID0gZ2V0QXV0aERhdGFNYW5hZ2VyKG9wdGlvbnMpO1xuICByZXR1cm4ge1xuICAgIGxvZ2dlckNvbnRyb2xsZXIsXG4gICAgZmlsZXNDb250cm9sbGVyLFxuICAgIHVzZXJDb250cm9sbGVyLFxuICAgIHB1c2hDb250cm9sbGVyLFxuICAgIGhhc1B1c2hTY2hlZHVsZWRTdXBwb3J0LFxuICAgIGhhc1B1c2hTdXBwb3J0LFxuICAgIHB1c2hXb3JrZXIsXG4gICAgcHVzaENvbnRyb2xsZXJRdWV1ZSxcbiAgICBhbmFseXRpY3NDb250cm9sbGVyLFxuICAgIGNhY2hlQ29udHJvbGxlcixcbiAgICBsaXZlUXVlcnlDb250cm9sbGVyLFxuICAgIGRhdGFiYXNlQ29udHJvbGxlcixcbiAgICBob29rc0NvbnRyb2xsZXIsXG4gICAgYXV0aERhdGFNYW5hZ2VyLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TG9nZ2VyQ29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpOiBMb2dnZXJDb250cm9sbGVyIHtcbiAgY29uc3Qge1xuICAgIGFwcElkLFxuICAgIGpzb25Mb2dzLFxuICAgIGxvZ3NGb2xkZXIsXG4gICAgdmVyYm9zZSxcbiAgICBsb2dMZXZlbCxcbiAgICBzaWxlbnQsXG4gICAgbG9nZ2VyQWRhcHRlcixcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGxvZ2dlck9wdGlvbnMgPSB7IGpzb25Mb2dzLCBsb2dzRm9sZGVyLCB2ZXJib3NlLCBsb2dMZXZlbCwgc2lsZW50IH07XG4gIGNvbnN0IGxvZ2dlckNvbnRyb2xsZXJBZGFwdGVyID0gbG9hZEFkYXB0ZXIobG9nZ2VyQWRhcHRlciwgV2luc3RvbkxvZ2dlckFkYXB0ZXIsIGxvZ2dlck9wdGlvbnMpO1xuICByZXR1cm4gbmV3IExvZ2dlckNvbnRyb2xsZXIobG9nZ2VyQ29udHJvbGxlckFkYXB0ZXIsIGFwcElkLCBsb2dnZXJPcHRpb25zKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpbGVzQ29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpOiBGaWxlc0NvbnRyb2xsZXIge1xuICBjb25zdCB7XG4gICAgYXBwSWQsXG4gICAgZGF0YWJhc2VVUkksXG4gICAgZmlsZXNBZGFwdGVyLFxuICAgIGRhdGFiYXNlQWRhcHRlcixcbiAgICBwcmVzZXJ2ZUZpbGVOYW1lLFxuICB9ID0gb3B0aW9ucztcbiAgaWYgKCFmaWxlc0FkYXB0ZXIgJiYgZGF0YWJhc2VBZGFwdGVyKSB7XG4gICAgdGhyb3cgJ1doZW4gdXNpbmcgYW4gZXhwbGljaXQgZGF0YWJhc2UgYWRhcHRlciwgeW91IG11c3QgYWxzbyB1c2UgYW4gZXhwbGljaXQgZmlsZXNBZGFwdGVyLic7XG4gIH1cbiAgY29uc3QgZmlsZXNDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKGZpbGVzQWRhcHRlciwgKCkgPT4ge1xuICAgIHJldHVybiBuZXcgR3JpZFN0b3JlQWRhcHRlcihkYXRhYmFzZVVSSSk7XG4gIH0pO1xuICByZXR1cm4gbmV3IEZpbGVzQ29udHJvbGxlcihmaWxlc0NvbnRyb2xsZXJBZGFwdGVyLCBhcHBJZCwgeyBwcmVzZXJ2ZUZpbGVOYW1lIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckNvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zKTogVXNlckNvbnRyb2xsZXIge1xuICBjb25zdCB7XG4gICAgYXBwSWQsXG4gICAgZW1haWxBZGFwdGVyLFxuICAgIHZlcmlmeVVzZXJFbWFpbHMsXG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBlbWFpbENvbnRyb2xsZXJBZGFwdGVyID0gbG9hZEFkYXB0ZXIoZW1haWxBZGFwdGVyKTtcbiAgcmV0dXJuIG5ldyBVc2VyQ29udHJvbGxlcihlbWFpbENvbnRyb2xsZXJBZGFwdGVyLCBhcHBJZCwgeyB2ZXJpZnlVc2VyRW1haWxzIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FjaGVDb250cm9sbGVyKG9wdGlvbnM6IFBhcnNlU2VydmVyT3B0aW9ucyk6IENhY2hlQ29udHJvbGxlciB7XG4gIGNvbnN0IHtcbiAgICBhcHBJZCxcbiAgICBjYWNoZUFkYXB0ZXIsXG4gICAgY2FjaGVUVEwsXG4gICAgY2FjaGVNYXhTaXplLFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgY2FjaGVDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKGNhY2hlQWRhcHRlciwgSW5NZW1vcnlDYWNoZUFkYXB0ZXIsIHthcHBJZDogYXBwSWQsIHR0bDogY2FjaGVUVEwsIG1heFNpemU6IGNhY2hlTWF4U2l6ZSB9KTtcbiAgcmV0dXJuIG5ldyBDYWNoZUNvbnRyb2xsZXIoY2FjaGVDb250cm9sbGVyQWRhcHRlciwgYXBwSWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QW5hbHl0aWNzQ29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpOiBBbmFseXRpY3NDb250cm9sbGVyIHtcbiAgY29uc3Qge1xuICAgIGFuYWx5dGljc0FkYXB0ZXIsXG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBhbmFseXRpY3NDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKGFuYWx5dGljc0FkYXB0ZXIsIEFuYWx5dGljc0FkYXB0ZXIpO1xuICByZXR1cm4gbmV3IEFuYWx5dGljc0NvbnRyb2xsZXIoYW5hbHl0aWNzQ29udHJvbGxlckFkYXB0ZXIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGl2ZVF1ZXJ5Q29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpOiBMaXZlUXVlcnlDb250cm9sbGVyIHtcbiAgcmV0dXJuIG5ldyBMaXZlUXVlcnlDb250cm9sbGVyKG9wdGlvbnMubGl2ZVF1ZXJ5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERhdGFiYXNlQ29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMsIGNhY2hlQ29udHJvbGxlcjogQ2FjaGVDb250cm9sbGVyKTogRGF0YWJhc2VDb250cm9sbGVyIHtcbiAgY29uc3Qge1xuICAgIGRhdGFiYXNlVVJJLFxuICAgIGRhdGFiYXNlT3B0aW9ucyxcbiAgICBjb2xsZWN0aW9uUHJlZml4LFxuICAgIHNjaGVtYUNhY2hlVFRMLFxuICAgIGVuYWJsZVNpbmdsZVNjaGVtYUNhY2hlLFxuICB9ID0gb3B0aW9ucztcbiAgbGV0IHtcbiAgICBkYXRhYmFzZUFkYXB0ZXJcbiAgfSA9IG9wdGlvbnM7XG4gIGlmICgoZGF0YWJhc2VPcHRpb25zIHx8IChkYXRhYmFzZVVSSSAmJiBkYXRhYmFzZVVSSSAhPT0gZGVmYXVsdHMuZGF0YWJhc2VVUkkpIHx8IGNvbGxlY3Rpb25QcmVmaXggIT09IGRlZmF1bHRzLmNvbGxlY3Rpb25QcmVmaXgpICYmIGRhdGFiYXNlQWRhcHRlcikge1xuICAgIHRocm93ICdZb3UgY2Fubm90IHNwZWNpZnkgYm90aCBhIGRhdGFiYXNlQWRhcHRlciBhbmQgYSBkYXRhYmFzZVVSSS9kYXRhYmFzZU9wdGlvbnMvY29sbGVjdGlvblByZWZpeC4nO1xuICB9IGVsc2UgaWYgKCFkYXRhYmFzZUFkYXB0ZXIpIHtcbiAgICBkYXRhYmFzZUFkYXB0ZXIgPSBnZXREYXRhYmFzZUFkYXB0ZXIoZGF0YWJhc2VVUkksIGNvbGxlY3Rpb25QcmVmaXgsIGRhdGFiYXNlT3B0aW9ucylcbiAgfSBlbHNlIHtcbiAgICBkYXRhYmFzZUFkYXB0ZXIgPSBsb2FkQWRhcHRlcihkYXRhYmFzZUFkYXB0ZXIpXG4gIH1cbiAgcmV0dXJuIG5ldyBEYXRhYmFzZUNvbnRyb2xsZXIoZGF0YWJhc2VBZGFwdGVyLCBuZXcgU2NoZW1hQ2FjaGUoY2FjaGVDb250cm9sbGVyLCBzY2hlbWFDYWNoZVRUTCwgZW5hYmxlU2luZ2xlU2NoZW1hQ2FjaGUpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEhvb2tzQ29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMsIGRhdGFiYXNlQ29udHJvbGxlcjogRGF0YWJhc2VDb250cm9sbGVyKTogSG9va3NDb250cm9sbGVyIHtcbiAgY29uc3Qge1xuICAgIGFwcElkLFxuICAgIHdlYmhvb2tLZXksXG4gIH0gPSBvcHRpb25zO1xuICByZXR1cm4gbmV3IEhvb2tzQ29udHJvbGxlcihhcHBJZCwgZGF0YWJhc2VDb250cm9sbGVyLCB3ZWJob29rS2V5KTtcbn1cblxuaW50ZXJmYWNlIFB1c2hDb250cm9sbGluZyB7XG4gIHB1c2hDb250cm9sbGVyOiBQdXNoQ29udHJvbGxlcixcbiAgaGFzUHVzaFNjaGVkdWxlZFN1cHBvcnQ6IGJvb2xlYW4sXG4gIHB1c2hDb250cm9sbGVyUXVldWU6IFB1c2hRdWV1ZSxcbiAgcHVzaFdvcmtlcjogUHVzaFdvcmtlclxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHVzaENvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zKTogUHVzaENvbnRyb2xsaW5nIHtcbiAgY29uc3Qge1xuICAgIHNjaGVkdWxlZFB1c2gsXG4gICAgcHVzaCxcbiAgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgcHVzaE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBwdXNoKTtcbiAgY29uc3QgcHVzaFF1ZXVlT3B0aW9ucyA9IHB1c2hPcHRpb25zLnF1ZXVlT3B0aW9ucyB8fCB7fTtcbiAgaWYgKHB1c2hPcHRpb25zLnF1ZXVlT3B0aW9ucykge1xuICAgIGRlbGV0ZSBwdXNoT3B0aW9ucy5xdWV1ZU9wdGlvbnM7XG4gIH1cblxuICAvLyBQYXNzIHRoZSBwdXNoIG9wdGlvbnMgdG9vIGFzIGl0IHdvcmtzIHdpdGggdGhlIGRlZmF1bHRcbiAgY29uc3QgcHVzaEFkYXB0ZXIgPSBsb2FkQWRhcHRlcihwdXNoT3B0aW9ucyAmJiBwdXNoT3B0aW9ucy5hZGFwdGVyLCBQYXJzZVB1c2hBZGFwdGVyLCBwdXNoT3B0aW9ucyk7XG4gIC8vIFdlIHBhc3MgdGhlIG9wdGlvbnMgYW5kIHRoZSBiYXNlIGNsYXNzIGZvciB0aGUgYWRhdHBlcixcbiAgLy8gTm90ZSB0aGF0IHBhc3NpbmcgYW4gaW5zdGFuY2Ugd291bGQgd29yayB0b29cbiAgY29uc3QgcHVzaENvbnRyb2xsZXIgPSBuZXcgUHVzaENvbnRyb2xsZXIoKTtcbiAgY29uc3QgaGFzUHVzaFN1cHBvcnQgPSAhIShwdXNoQWRhcHRlciAmJiBwdXNoKTtcbiAgY29uc3QgaGFzUHVzaFNjaGVkdWxlZFN1cHBvcnQgPSBoYXNQdXNoU3VwcG9ydCAmJiAoc2NoZWR1bGVkUHVzaCA9PT0gdHJ1ZSk7XG5cbiAgY29uc3Qge1xuICAgIGRpc2FibGVQdXNoV29ya2VyXG4gIH0gPSBwdXNoUXVldWVPcHRpb25zO1xuXG4gIGNvbnN0IHB1c2hDb250cm9sbGVyUXVldWUgPSBuZXcgUHVzaFF1ZXVlKHB1c2hRdWV1ZU9wdGlvbnMpO1xuICBsZXQgcHVzaFdvcmtlcjtcbiAgaWYgKCFkaXNhYmxlUHVzaFdvcmtlcikge1xuICAgIHB1c2hXb3JrZXIgPSBuZXcgUHVzaFdvcmtlcihwdXNoQWRhcHRlciwgcHVzaFF1ZXVlT3B0aW9ucyk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBwdXNoQ29udHJvbGxlcixcbiAgICBoYXNQdXNoU3VwcG9ydCxcbiAgICBoYXNQdXNoU2NoZWR1bGVkU3VwcG9ydCxcbiAgICBwdXNoQ29udHJvbGxlclF1ZXVlLFxuICAgIHB1c2hXb3JrZXJcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXV0aERhdGFNYW5hZ2VyKG9wdGlvbnM6IFBhcnNlU2VydmVyT3B0aW9ucykge1xuICBjb25zdCB7XG4gICAgYXV0aCxcbiAgICBlbmFibGVBbm9ueW1vdXNVc2Vyc1xuICB9ID0gb3B0aW9ucztcbiAgcmV0dXJuIGF1dGhEYXRhTWFuYWdlcihhdXRoLCBlbmFibGVBbm9ueW1vdXNVc2Vycylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERhdGFiYXNlQWRhcHRlcihkYXRhYmFzZVVSSSwgY29sbGVjdGlvblByZWZpeCwgZGF0YWJhc2VPcHRpb25zKSB7XG4gIGxldCBwcm90b2NvbDtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWRVUkkgPSB1cmwucGFyc2UoZGF0YWJhc2VVUkkpO1xuICAgIHByb3RvY29sID0gcGFyc2VkVVJJLnByb3RvY29sID8gcGFyc2VkVVJJLnByb3RvY29sLnRvTG93ZXJDYXNlKCkgOiBudWxsO1xuICB9IGNhdGNoKGUpIHsgLyogKi8gfVxuICBzd2l0Y2ggKHByb3RvY29sKSB7XG4gIGNhc2UgJ3Bvc3RncmVzOic6XG4gICAgcmV0dXJuIG5ldyBQb3N0Z3Jlc1N0b3JhZ2VBZGFwdGVyKHtcbiAgICAgIHVyaTogZGF0YWJhc2VVUkksXG4gICAgICBjb2xsZWN0aW9uUHJlZml4LFxuICAgICAgZGF0YWJhc2VPcHRpb25zXG4gICAgfSk7XG4gIGRlZmF1bHQ6XG4gICAgcmV0dXJuIG5ldyBNb25nb1N0b3JhZ2VBZGFwdGVyKHtcbiAgICAgIHVyaTogZGF0YWJhc2VVUkksXG4gICAgICBjb2xsZWN0aW9uUHJlZml4LFxuICAgICAgbW9uZ29PcHRpb25zOiBkYXRhYmFzZU9wdGlvbnMsXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==